plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.jetbrains.kotlin.android)
    id('maven-publish')
}

apply plugin: 'signing'

android {
    namespace 'com.engage.engageadssdk'
    compileSdk 34

    defaultConfig {
        minSdk 24
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        consumerProguardFiles "consumer-rules.pro"
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = '1.8'
    }
}

dependencies {

    implementation libs.androidx.core.ktx
    implementation libs.androidx.appcompat
    implementation libs.material
    testImplementation libs.junit
    androidTestImplementation libs.androidx.junit
    androidTestImplementation libs.androidx.espresso.core

    // Media3
    implementation("androidx.media3:media3-ui:1.3.1")
    implementation("androidx.media3:media3-exoplayer:1.3.1")
    implementation("androidx.media3:media3-exoplayer-ima:1.3.1")

    // Lifecycle
    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.5.1")
    implementation("androidx.lifecycle:lifecycle-common-java8:2.5.1")

    // IMA SDK
    implementation("com.google.ads.interactivemedia.v3:interactivemedia:3.26.0")

    // Simple XML
    implementation("org.simpleframework:simple-xml:2.7.1")

    // OkHttp
    implementation("com.squareup.okhttp3:okhttp:4.10.0")
    implementation 'com.google.code.gson:gson:2.8.8'

}

publishing {
    publications {
        release(MavenPublication) {

            groupId = 'com.github.engage-media'
            artifactId = 'engage-ads-sdk'
            version = '1.0.15-alpha'

            // Include the AAR
            artifact("$buildDir/outputs/aar/engage-ads-sdk-release.aar")

            pom {
                name.set('Engage Ads SDK')
                description.set('SDK for integrating Engage Ads')
                url.set('https://github.com/engage-media/engage-ads-sdk')

                licenses {
                    license {
                        name.set('The Apache License, Version 2.0')
                        url.set('http://www.apache.org/licenses/LICENSE-2.0.txt')
                    }
                }

                developers {
                    developer {
                        id.set('engage-media')
                        name.set('Engage Media')
                        email.set('support@engage-media.com')
                    }
                }

                scm {
                    connection.set('scm:git:git://github.com/engage-media/engage-ads-sdk.git')
                    developerConnection.set('scm:git:ssh://github.com:engage-media/engage-ads-sdk.git')
                    url.set('https://github.com/engage-media/engage-ads-sdk')
                }
            }
        }
    }

    repositories {
        maven {
            name = "jitpack"
            url = uri("https://jitpack.io")
        }
    }
}
